---
replicaCount: 1

gluetunUrl: ''
gluetunApiKey: ''
qbittorrentUrl: ''
uptimeKumaUrl: ''
uptimeKumaStatusSlug: ''

image:
  repository: glanceapp/glance
  pullPolicy: IfNotPresent
  tag: latest

service:
  type: ClusterIP
  port: 8080

ingress:
  enabled: true
  ingressClassName: traefik
  annotations:
    kubernetes.io/ingress.class: traefik
    cert-manager.io/cluster-issuer: mkcert-ca
  hosts:
    - host: dashboard.home.arpa
      paths:
        - path: /
          pathType: Prefix
  tls:
    - hosts:
        - dashboard.home.arpa
      secretName: homarr-mkcert-tls

persistence:
  enabled: false
resources: {}

nodeSelector: {}

tolerations: []

affinity: {}

env:
  TZ: Europe/Paris
config: |-
  server:
    port: 8080
    proxied: true

  theme:
    background-color: 240 8 9
    primary-color: 43 50 70
    contrast-multiplier: 1.3

  auth:
    secret-key:
    users:
      admin:
        password:

  pages:
    - name: Home
      columns:
        - size: small
          widgets:
            - type: calendar
              first-day-of-week: monday
            - type: weather
              location: Paris, France
              units: metric
              hour-format: 24h
            - type: to-do

        - size: full
          widgets:
            - type: bookmarks
              groups:
                - title: Tools
                  links:
                    - title: Stirling PDF
                      url: https://stirling-pdf.${DOMAIN_NAME}
                      icon: sh:stirling-pdf
                    - title: Linkwarden
                      url: https://linkwarden.${DOMAIN_NAME}
                      icon: sh:linkwarden
                    - title: n8n
                      url: https://n8n.${DOMAIN_NAME}
                      icon: di:n8n

                - title: Media
                  links:
                    - title: Jellyfin
                      url: https://jellyfin.${DOMAIN_NAME}
                      icon: di:jellyfin
                    - title: Jellyseerr
                      url: https://jellyseerr.${DOMAIN_NAME}
                      icon: di:jellyseerr
                    - title: Immich
                      url: https://immich.${DOMAIN_NAME}
                      icon: di:immich

                - title: Downloads
                  links:
                    - title: qBittorrent
                      url: https://qbittorrent.${DOMAIN_NAME}
                      icon: di:qbittorrent
                    - title: Prowlarr
                      url: https://prowlarr.${DOMAIN_NAME}
                      icon: di:prowlarr
                    - title: Radarr
                      url: https://radarr.${DOMAIN_NAME}
                      icon: di:radarr
                    - title: Sonarr
                      url: https://sonarr.${DOMAIN_NAME}
                      icon: di:sonarr
                    - title: Bazarr
                      url: https://bazarr.${DOMAIN_NAME}
                      icon: di:bazarr

                - title: Tech
                  links:
                    - title: Uptime Kuma
                      url: https://status.${DOMAIN_NAME}
                      icon: di:uptime-kuma
                    - title: FRP dashboard
                      url: https://frp.${DOMAIN_NAME}
                      icon: di:frp
                    - title: pgAdmin
                      url: https://pgadmin.${DOMAIN_NAME}
                      icon: di:postgresql
                    - title: dozzle
                      url: https://dozzle.${DOMAIN_NAME}
                      icon: di:dozzle
                    - title: Vibe-kanban
                      url: https://vibe-kanban.${DOMAIN_NAME}
                      icon: https://raw.githubusercontent.com/VDuchauffour/homelab/refs/heads/main/kubernetes/apps/glance/favicon.png

            - type: hacker-news
              limit: 10
              collapse-after: 5

        - size: small
          widgets:
            - type: server-stats
              servers:
                - type: local
                  name: Services
            - type: custom-api
              title: Gluetun status
              cache: 1m
              url: http://${GLUETUN_URL}/v1/publicip/ip
              headers:
                X-API-Key: ${GLUETUN_API_KEY}
              template: |
                {{ if eq .Response.StatusCode 200 }}
                  {{ $ip := (.JSON.String "public_ip") }}
                  {{ $city := (.JSON.String "city") }}
                  {{ $country := (.JSON.String "country") }}
                  {{ if eq $ip "" }}
                    <div>
                      <div>
                        <div>
                          <div class="color-highlight size-h3">
                            Your VPN is not connected!
                            <span class="color-negative">●</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  {{ else }}
                    <div>
                      <div>
                        <div>
                          <div class="color-highlight size-h3">
                            Your VPN is connected!
                            <span class="color-positive">●</span>
                          </div>
                        </div>
                        <div class="size-h5">{{ $ip }} - {{ $city }}, {{ $country }}</div>
                      </div>
                    </div>
                  {{ end }}
                {{ else }}
                  <div style="text-align: center; color: var(--color-negative);">
                    Error: {{ .Response.StatusCode }} - {{ .Response.Status }}
                  </div>
                {{ end }}
            - type: custom-api
              title: qBittorrent
              cache: 10s
              options:
                view: "detailed"
                mode: "default"
              subrequests:
                transfer:
                  url: http://${QBITTORRENT_URL}/api/v2/transfer/info
                seeding:
                  url: http://${QBITTORRENT_URL}/api/v2/torrents/info
                  parameters:
                    filter: seeding
                leeching:
                  url: http://${QBITTORRENT_URL}/api/v2/torrents/info
                  parameters:
                    filter: downloading
              template: |
                {{ $transfer := .Subrequest "transfer" }}
                {{ $seeding := .Subrequest "seeding" }}
                {{ $leeching := .Subrequest "leeching" }}

                {{ if and (eq $transfer.Response.StatusCode 200) (eq $seeding.Response.StatusCode 200) (eq $leeching.Response.StatusCode 200) }}

                  {{ $isDetailed := eq (.Options.StringOr "view" "detailed") "detailed" }}
                  {{ $mode := .Options.StringOr "mode" "default" }}

                  {{ if $isDetailed }}
                  <!-- Detailed View -->
                  <div class="list" style="--list-gap: 15px;">
                    <div class="flex justify-between text-center">
                      <div>
                        {{ $dlSpeed := $transfer.JSON.Float "dl_info_speed" }}
                        {{ if eq $mode "upload" }}
                          <div class="color-highlight size-h3">{{ printf "%.1f MB/s" (div $dlSpeed 1000000.0) }}</div>
                        {{ else }}
                          {{ if lt $dlSpeed 1048576.0 }}
                            <div class="color-highlight size-h3">{{ printf "%.0f KiB/s" (div $dlSpeed 1024.0) }}</div>
                          {{ else }}
                            <div class="color-highlight size-h3">{{ printf "%.1f MiB/s" (div $dlSpeed 1048576.0) }}</div>
                          {{ end }}
                        {{ end }}
                        <div class="size-h6">DOWNLOADING</div>
                      </div>

                      {{ if eq $mode "upload" }}
                      <div>
                        {{ $ulSpeed := $transfer.JSON.Float "up_info_speed" }}
                        <div class="color-highlight size-h3">{{ printf "%.1f MB/s" (div $ulSpeed 1000000.0) }}</div>
                        <div class="size-h6">UPLOADING</div>
                      </div>
                      {{ end }}

                      <div>
                        <div class="color-highlight size-h3">{{ len ($seeding.JSON.Array "") }}</div>
                        <div class="size-h6">SEEDING</div>
                      </div>

                      {{ if eq $mode "default" }}
                      <div>
                        <div class="color-highlight size-h3">{{ len ($leeching.JSON.Array "") }}</div>
                        <div class="size-h6">LEECHING</div>
                      </div>
                      {{ end }}
                    </div>

                    <!-- Downloading list -->
                    {{ $downloadingTorrents := $leeching.JSON.Array "" }}
                    {{ if gt (len $downloadingTorrents) 0 }}
                      <div style="margin-top: 15px;">
                        <ul class="list collapsible-container" data-collapse-after="0" style="--list-gap: 15px;">
                          {{ range $t := $downloadingTorrents }}
                            {{ $state := $t.String "state" }}
                            {{ $icon := "?" }}
                            {{ if ge ($t.Int "completed") ($t.Int "size") }}{{ $icon = "✔" }}
                            {{ else if eq $state "downloading" "forcedDL" }}{{ $icon = "↓" }}
                            {{ else if eq $state "pausedDL" "stoppedDL" "pausedUP" "stalledDL" "stalledUP" "queuedDL" "queuedUP" }}{{ $icon = "❚❚" }}
                            {{ else if eq $state "error" "missingFiles" }}{{ $icon = "!" }}
                            {{ else if eq $state "checkingDL" "checkingUP" "allocating" }}{{ $icon = "…" }}
                            {{ else if eq $state "checkingResumeData" }}{{ $icon = "⟳" }}
                            {{ end }}

                            <li class="flex items-center" style="gap: 10px;">
                              <div class="size-h4" style="flex-shrink: 0;">{{ $icon }}</div>
                              <div style="flex-grow: 1; min-width: 0;">
                                <div class="text-truncate color-highlight">{{ $t.String "name" }}</div>
                                <div title="{{ $t.Float "progress" | mul 100 | printf "%.1f" }}%" style="background: rgba(128, 128, 128, 0.2); border-radius: 5px; height: 6px; margin-top: 5px; overflow: hidden;">
                                  <div style="width: {{ $t.Float "progress" | mul 100 }}%; background-color: var(--color-positive); height: 100%; border-radius: 5px;"></div>
                                </div>
                              </div>
                              <div style="flex-shrink: 0; text-align: right; width: 80px;">
                                {{ $dlSpeed := $t.Float "dlspeed" }}
                                <div class="size-sm color-paragraph">
                                  {{ if eq $mode "upload" }}
                                    {{ if lt $dlSpeed 1000.0 }}--{{ else }}{{ printf "%.1f MB/s" (div $dlSpeed 1000000.0) }}{{ end }}
                                  {{ else }}
                                    {{ if lt $dlSpeed 1024.0 }}--{{ else if lt $dlSpeed 1048576.0 }}{{ printf "%.0f KiB/s" (div $dlSpeed 1024.0) }}{{ else }}{{ printf "%.1f MiB/s" (div $dlSpeed 1048576.0) }}{{ end }}
                                  {{ end }}
                                </div>
                                {{ $eta := $t.Int "eta" }}
                                <div class="size-sm color-paragraph">
                                  {{ if eq $eta 8640000 }}∞
                                  {{ else if gt $eta 3600 }}{{ printf "%dh %dm" (div $eta 3600) (mod (div $eta 60) 60) }}
                                  {{ else if gt $eta 0 }}{{ printf "%dm" (div $eta 60) }}
                                  {{ else }}--{{ end }}
                                </div>
                              </div>
                            </li>
                          {{ end }}
                        </ul>
                      </div>
                    {{ end }}

                    <!-- Seeding list -->
                    {{ if eq $mode "upload" }}
                      {{ $seedingTorrents := $seeding.JSON.Array "" }}
                      {{ if gt (len $seedingTorrents) 0 }}
                        <div style="margin-top: 20px;">
                          <ul class="list collapsible-container" data-collapse-after="0" style="--list-gap: 15px;">
                            {{ range $t := $seedingTorrents }}
                              {{ $state := $t.String "state" }}
                              {{ $icon := "↑" }}
                              {{ if eq $state "pausedUP" "stoppedUP" "stalledUP" "queuedUP" }}{{ $icon = "❚❚" }}
                              {{ else if eq $state "error" "missingFiles" }}{{ $icon = "!" }}
                              {{ else if eq $state "checkingUP" }}{{ $icon = "…" }}
                              {{ else if eq $state "checkingResumeData" }}{{ $icon = "⟳" }}
                              {{ end }}

                              <li class="flex items-center" style="gap: 10px;">
                                <div class="size-h4" style="flex-shrink: 0;">{{ $icon }}</div>
                                <div style="flex-grow: 1; min-width: 0;">
                                  <div class="text-truncate color-highlight">{{ $t.String "name" }}</div>
                                  <div class="size-sm color-paragraph">
                                    Ratio: {{ printf "%.2f" ($t.Float "ratio") }} |
                                    Size: {{ printf "%.1f GB" (div ($t.Float "size") 1073741824.0) }}
                                  </div>
                                </div>
                                <div style="flex-shrink: 0; text-align: right; width: 80px;">
                                  {{ $ulSpeed := $t.Float "upspeed" }}
                                  <div class="size-sm color-paragraph">
                                    {{ if lt $ulSpeed 1000.0 }}--{{ else }}{{ printf "%.1f MB/s" (div $ulSpeed 1000000.0) }}{{ end }}
                                  </div>
                                  <div class="size-sm color-paragraph">Upload</div>
                                </div>
                              </li>
                            {{ end }}
                          </ul>
                        </div>
                      {{ end }}
                    {{ end }}

                  </div>

                  {{ else }}
                  <!-- Basic View -->
                  <div class="flex justify-between text-center">
                    <div>
                      {{ $dlSpeed := $transfer.JSON.Float "dl_info_speed" }}
                      <div class="color-highlight size-h3">{{ printf "%.1f MB/s" (div $dlSpeed 1000000.0) }}</div>
                      <div class="size-h6">DOWNLOADING</div>
                    </div>
                    {{ if eq $mode "upload" }}
                    <div>
                      {{ $ulSpeed := $transfer.JSON.Float "up_info_speed" }}
                      <div class="color-highlight size-h3">{{ printf "%.1f MB/s" (div $ulSpeed 1000000.0) }}</div>
                      <div class="size-h6">UPLOADING</div>
                    </div>
                    {{ end }}
                    <div>
                      <div class="color-highlight size-h3">{{ len ($seeding.JSON.Array "") }}</div>
                      <div class="size-h6">SEEDING</div>
                    </div>
                    {{ if eq $mode "default" }}
                    <div>
                      <div class="color-highlight size-h3">{{ len ($leeching.JSON.Array "") }}</div>
                      <div class="size-h6">LEECHING</div>
                    </div>
                    {{ end }}
                  </div>
                  {{ end }}

                {{ else }}
                  <div class="color-negative text-center">
                    <p>Error fetching qBittorrent data.</p>
                    <p class="size-sm">Check URL and authentication bypass settings.</p>
                  </div>
                {{ end }}
            - type: custom-api
              title: Uptime Kuma
              title-url: ${UPTIME_KUMA_URL}
              url: ${UPTIME_KUMA_URL}/api/status-page/${UPTIME_KUMA_STATUS_SLUG}
              subrequests:
                heartbeats:
                  url: ${UPTIME_KUMA_URL}/api/status-page/heartbeat/${UPTIME_KUMA_STATUS_SLUG}
              cache: 10m
              template: |
                {{ $hb := .Subrequest "heartbeats" }}

                {{ if not (.JSON.Exists "publicGroupList") }}
                <p class="color-negative">Error reading response</p>
                {{ else if eq (len (.JSON.Array "publicGroupList")) 0 }}
                <p>No monitors found</p>
                {{ else }}

                <ul class="dynamic-columns list-gap-8">
                  {{ range .JSON.Array "publicGroupList" }}
                  {{ range .Array "monitorList" }}
                  {{ $id := .String "id" }}
                  {{ $hbArray := $hb.JSON.Array (print "heartbeatList." $id) }}
                  <div class="flex items-center gap-12">
                    <a class="size-title-dynamic color-highlight text-truncate block grow" href="${UPTIME_KUMA_URL}/dashboard/{{ $id }}"
                      target="_blank" rel="noreferrer">
                      {{ .String "name" }} </a>

                    {{ if gt (len $hbArray) 0 }}
                      {{ $latest := index $hbArray (sub (len $hbArray) 1) }}
                      {{ if eq ($latest.Int "status") 1 }}
                      <div>{{ $latest.Int "ping" }}ms</div>
                      <div class="monitor-site-status-icon-compact" title="OK">
                        <svg fill="var(--color-positive)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                          <path fill-rule="evenodd"
                            d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z"
                            clip-rule="evenodd"></path>
                        </svg>
                      </div>
                      {{ else }}
                      <div><span class="color-negative">DOWN</span></div>
                      <div class="monitor-site-status-icon-compact" title="{{ if $latest.Exists "msg" }}{{ $latest.String "msg" }}{{ else }}Error{{ end }}">
                        <svg fill="var(--color-negative)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                          <path fill-rule="evenodd"
                            d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495ZM10 5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 5Zm0 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"
                            clip-rule="evenodd"></path>
                        </svg>
                      </div>
                      {{ end }}
                    {{ else }}
                      <div><span class="color-negative">No data</span></div>
                      <div class="monitor-site-status-icon-compact" title="No data available">
                        <svg fill="var(--color-negative)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                          <path d="M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm0-2a6 6 0 1 0 0-12 6 6 0 0 0 0 12zm-.75-8a.75.75 0 0 1 1.5 0v3a.75.75 0 0 1-1.5 0V8zm.75 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                        </svg>
                      </div>
                    {{ end }}
                  </div>
                  {{ end }}
                  {{ end }}
                </ul>
                {{ end }}
